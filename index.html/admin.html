<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Haken Admin Center</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        stone: {
                            850: '#1c1917',
                            950: '#0c0a09',
                        }
                    },
                    animation: {
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(234, 88, 12, 0.2)' },
                            '100%': { boxShadow: '0 0 20px rgba(234, 88, 12, 0.6), 0 0 10px rgba(234, 88, 12, 0.4)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap'); 
        
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #44403c; }
        
        /* UI Components */
        .desk-nav { @apply w-full flex items-center gap-3 px-4 py-3 text-stone-500 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-800/50 rounded-xl text-sm font-medium transition-all duration-300; }
        .desk-nav.active { @apply bg-stone-900 dark:bg-orange-600 text-white shadow-lg shadow-stone-200 dark:shadow-orange-900/20 font-bold translate-x-1; }
        
        /* Input Field Fix (Point 9) */
        .input-field { 
            @apply w-full p-4 rounded-xl text-sm border outline-none transition-colors;
            @apply bg-white border-stone-200 text-stone-900 focus:border-orange-500; /* Light Mode */
            @apply dark:bg-stone-800 dark:border-stone-700 dark:text-white dark:focus:border-orange-500; /* Dark Mode */
        }
        
        /* Chart Buttons Fix (Point 3) */
        .chart-btn { @apply flex-1 md:flex-none px-4 py-2 text-xs font-bold rounded-lg border text-center transition-all duration-200 active:scale-95 select-none; }
        .chart-btn-inactive { @apply border-stone-200 text-stone-500 hover:bg-stone-50 dark:border-stone-700 dark:text-stone-400 dark:hover:bg-stone-800; }
        .chart-btn-active { @apply bg-stone-900 text-white border-stone-900 dark:bg-orange-600 dark:border-orange-600 dark:text-white shadow-md transform scale-105; }

        .stat-card { @apply bg-white dark:bg-stone-900 p-6 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-lg dark:hover:shadow-stone-900/50 transition-all duration-300 hover:-translate-y-1 cursor-pointer active:scale-95; }
        .btn-primary { @apply py-3 px-6 bg-stone-900 dark:bg-orange-600 text-white rounded-xl font-bold shadow-lg shadow-stone-200 dark:shadow-orange-900/20 hover:scale-[1.02] active:scale-95 transition-all duration-300; }

        /* Ultra Blur Navbar (Point 2) */
        .glass-nav { @apply backdrop-blur-2xl bg-white/70 dark:bg-stone-950/70 border-stone-200/50 dark:border-stone-800/50 supports-[backdrop-filter]:bg-white/60; }
        
        .animate-fade-in { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-[#FDFCFC] dark:bg-stone-950 text-stone-800 dark:text-stone-200 h-screen overflow-hidden transition-colors duration-500">

    <div id="loginGate" class="fixed inset-0 z-[100] bg-stone-50/50 dark:bg-stone-950/80 backdrop-blur-xl flex items-center justify-center p-4 transition-all duration-500">
        <div class="bg-white dark:bg-stone-900 p-10 rounded-[2.5rem] w-full max-w-sm text-center shadow-2xl border border-white/20 dark:border-stone-800 relative overflow-hidden">
            <div class="w-24 h-24 bg-stone-50 dark:bg-stone-800 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner">
                <i data-lucide="shield-check" class="w-10 h-10 text-stone-900 dark:text-orange-500"></i>
            </div>
            <h2 class="text-3xl font-serif font-bold mb-2 text-stone-900 dark:text-white">Haken Admin</h2>
            <p class="text-stone-500 dark:text-stone-400 text-sm mb-10">Secure Database Access.</p>
            <button id="btnLogin" class="w-full py-4 bg-stone-900 dark:bg-white text-white dark:text-stone-900 rounded-2xl font-bold flex items-center justify-center gap-3 active:scale-95 hover:shadow-xl transition-all">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5">
                <span>Masuk dengan Google</span>
            </button>
            <p id="loginStatus" class="text-orange-600 text-xs mt-8 font-bold animate-pulse hidden tracking-widest uppercase">Verifying Access...</p>
        </div>
    </div>

    <div id="dashboardUI" class="flex h-full hidden flex-col md:flex-row transition-opacity duration-500 opacity-0">
        
        <aside class="hidden md:flex w-72 bg-white dark:bg-stone-900 border-r border-stone-100 dark:border-stone-800 flex-col z-20">
            <div class="p-8">
                <div class="flex items-center gap-3 mb-8">
                    <div class="w-10 h-10 bg-orange-600 rounded-xl flex items-center justify-center text-white font-serif font-bold text-xl shadow-lg shadow-orange-500/30">H</div>
                    <div>
                        <span class="text-xl font-bold tracking-tight text-stone-900 dark:text-white block">Haken.</span>
                        <span class="text-[10px] text-stone-400 uppercase tracking-widest font-bold">Control Center</span>
                    </div>
                </div>
                <div class="p-4 bg-stone-50 dark:bg-stone-800/50 rounded-2xl border border-stone-100 dark:border-stone-700/50 mb-2 flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-stone-200 dark:bg-stone-700 flex items-center justify-center text-xs font-bold">A</div>
                    <div class="overflow-hidden">
                        <p class="text-[10px] text-stone-400 font-bold uppercase">Admin</p>
                        <p id="adminEmailDisplay" class="text-xs font-bold truncate">...</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 px-6 space-y-2 overflow-y-auto no-scrollbar">
                <button onclick="window.switchTab('insight')" id="desk-insight" class="desk-nav active"><i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard</button>
                <button onclick="window.switchTab('orders')" id="desk-orders" class="desk-nav"><i data-lucide="shopping-bag" class="w-4 h-4"></i> Pesanan</button>
                <button onclick="window.switchTab('products')" id="desk-products" class="desk-nav"><i data-lucide="package" class="w-4 h-4"></i> Inventaris</button>
                <button onclick="window.switchTab('discounts')" id="desk-discounts" class="desk-nav"><i data-lucide="ticket-percent" class="w-4 h-4"></i> Promo</button>
                <button onclick="window.switchTab('settings')" id="desk-settings" class="desk-nav"><i data-lucide="settings" class="w-4 h-4"></i> Pengaturan</button>
            </nav>

            <div class="p-6 border-t border-stone-50 dark:border-stone-800 space-y-4">
                <button onclick="window.toggleDarkMode()" class="w-full flex items-center justify-between px-4 py-3 bg-stone-50 dark:bg-stone-800 rounded-xl text-xs font-bold">
                    <span class="dark:hidden flex items-center gap-2"><i data-lucide="moon" class="w-4 h-4"></i> Dark Mode</span>
                    <span class="hidden dark:flex items-center gap-2 text-orange-400"><i data-lucide="sun" class="w-4 h-4"></i> Light Mode</span>
                </button>
                <button onclick="window.logout()" class="w-full flex items-center justify-center gap-2 px-4 py-3 text-xs font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-colors">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Keluar
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto bg-[#FDFCFC] dark:bg-stone-950 pb-24 md:pb-0 relative scroll-smooth" id="mainScroll">
            <div class="md:hidden sticky top-0 z-30 glass-nav px-6 py-4 flex justify-between items-center border-b border-stone-100 dark:border-stone-800">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-orange-600 rounded-lg flex items-center justify-center text-white font-serif font-bold">H</div>
                    <span class="font-bold text-lg dark:text-white">Admin</span>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="window.toggleDarkMode()" class="p-2 bg-stone-100 dark:bg-stone-800 rounded-full text-stone-600 dark:text-stone-300">
                        <i data-lucide="moon" class="w-5 h-5 dark:hidden"></i>
                        <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                    </button>
                    <button onclick="window.logout()" class="p-2 bg-red-50 dark:bg-red-900/20 rounded-full text-red-500"><i data-lucide="log-out" class="w-5 h-5"></i></button>
                </div>
            </div>

            <div class="p-6 md:p-10 max-w-7xl mx-auto space-y-8 min-h-screen">
                
                <div id="tab-insight" class="animate-fade-in space-y-8">
                    
                    <div class="flex justify-between items-end">
                        <div>
                            <h1 class="text-3xl font-bold text-stone-900 dark:text-white mb-1">Overview</h1>
                            <p class="text-stone-500 dark:text-stone-400 text-sm">Monitor performa real-time.</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                        <div onclick="window.location.href='database.html'" class="stat-card group col-span-2 md:col-span-1">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-stone-50 dark:bg-stone-800 rounded-2xl"><i data-lucide="users" class="w-6 h-6 text-stone-900 dark:text-white"></i></div>
                                <span class="text-[10px] font-bold text-stone-400 bg-stone-50 dark:bg-stone-800 px-3 py-1 rounded-full">USER</span>
                            </div>
                            <h3 class="text-3xl md:text-4xl font-bold text-stone-900 dark:text-white mb-1" id="statUsers">0</h3>
                            <p class="text-xs text-stone-500 dark:text-stone-400">Pengguna Terdaftar</p>
                        </div>

                        <div onclick="window.focusChart('day')" class="stat-card group hover:ring-2 hover:ring-orange-500">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 text-orange-600 rounded-2xl"><i data-lucide="zap" class="w-6 h-6"></i></div>
                            </div>
                            <h3 class="text-2xl md:text-3xl font-bold text-stone-900 dark:text-white mb-1" id="statToday">Rp 0</h3>
                            <p class="text-xs text-stone-500">Pendapatan Hari Ini</p>
                        </div>

                        <div onclick="window.focusChart('week')" class="stat-card group hover:ring-2 hover:ring-orange-500">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded-2xl"><i data-lucide="bar-chart-2" class="w-6 h-6"></i></div>
                            </div>
                            <h3 class="text-2xl md:text-3xl font-bold text-stone-900 dark:text-white mb-1" id="statWeek">Rp 0</h3>
                            <p class="text-xs text-stone-500">Minggu Ini</p>
                        </div>
                        
                        <div onclick="window.focusChart('month')" class="stat-card group hover:ring-2 hover:ring-orange-500">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-purple-50 dark:bg-purple-900/20 text-purple-600 rounded-2xl"><i data-lucide="calendar" class="w-6 h-6"></i></div>
                            </div>
                            <h3 class="text-2xl md:text-3xl font-bold text-stone-900 dark:text-white mb-1" id="statMonth">Rp 0</h3>
                            <p class="text-xs text-stone-500">Bulan Ini</p>
                        </div>

                        <div onclick="window.focusChart('year')" class="stat-card group hover:ring-2 hover:ring-orange-500">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 rounded-2xl"><i data-lucide="trending-up" class="w-6 h-6"></i></div>
                            </div>
                            <h3 class="text-2xl md:text-3xl font-bold text-stone-900 dark:text-white mb-1" id="statYear">Rp 0</h3>
                            <p class="text-xs text-stone-500">Tahun Ini</p>
                        </div>

                        <div onclick="window.focusChart('total')" class="stat-card group col-span-2 hover:ring-2 hover:ring-green-500">
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-3 bg-green-50 dark:bg-green-900/20 text-green-600 rounded-2xl"><i data-lucide="wallet" class="w-6 h-6"></i></div>
                                <span class="text-[10px] font-bold text-green-600 bg-green-50 dark:bg-green-900/20 px-3 py-1 rounded-full">LIFETIME</span>
                            </div>
                            <h3 class="text-4xl font-bold text-stone-900 dark:text-white mb-1" id="statRevenue">Rp 0</h3>
                            <p class="text-xs text-stone-500 dark:text-stone-400">Total Pendapatan Bersih (Semua Waktu)</p>
                        </div>
                    </div>

                    <div id="chartSection" class="bg-white dark:bg-stone-900 p-6 md:p-8 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm relative overflow-hidden transition-all duration-500">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-8 relative z-10">
                            <div>
                                <h2 class="text-xl font-bold text-stone-900 dark:text-white">Analitik Penjualan</h2>
                                <p class="text-sm text-stone-400">Grafik pertumbuhan transaksi.</p>
                            </div>
                            <div class="flex flex-wrap gap-2 w-full md:w-auto justify-center md:justify-end">
                                <button onclick="window.updateChart('day')" class="chart-btn chart-btn-inactive" id="btn-chart-day">24 Jam</button>
                                <button onclick="window.updateChart('week')" class="chart-btn chart-btn-inactive" id="btn-chart-week">Minggu</button>
                                <button onclick="window.updateChart('month')" class="chart-btn chart-btn-inactive" id="btn-chart-month">Bulan</button>
                                <button onclick="window.updateChart('year')" class="chart-btn chart-btn-inactive" id="btn-chart-year">Tahun</button>
                                <button onclick="window.updateChart('total')" class="chart-btn chart-btn-inactive" id="btn-chart-total">Total</button>
                            </div>
                        </div>
                        
                        <div class="relative h-80 w-full z-10">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="tab-orders" class="hidden animate-fade-in pb-20">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold text-stone-900 dark:text-white">Pesanan Masuk</h1>
                        <span id="orderCountBadge" class="px-4 py-1.5 bg-stone-900 dark:bg-white text-white dark:text-stone-900 text-xs font-bold rounded-full shadow-lg">0 Order</span>
                    </div>
                    <div id="orderList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <div id="tab-products" class="hidden animate-fade-in pb-20">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-stone-900 dark:text-white">Inventaris</h1>
                            <p class="text-sm text-stone-400">Kelola katalog produk.</p>
                        </div>
                        <button onclick="window.openProductModal()" class="btn-primary flex items-center gap-2">
                            <i data-lucide="plus" class="w-5 h-5"></i> <span class="hidden md:inline">Tambah Produk</span>
                        </button>
                    </div>
                    
                    <div class="bg-white dark:bg-stone-900 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-sm whitespace-nowrap">
                                <thead class="bg-stone-50 dark:bg-stone-800 text-stone-500 dark:text-stone-400 font-bold uppercase text-xs tracking-wider">
                                    <tr>
                                        <th class="p-6">Produk</th>
                                        <th class="p-6 hidden md:table-cell">Kategori</th> <th class="p-6">Stok & Harga</th>
                                        <th class="p-6 text-right">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="productTableBody" class="divide-y divide-stone-50 dark:divide-stone-800 text-stone-600 dark:text-stone-300"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="tab-discounts" class="hidden animate-fade-in pb-20">
                    <h1 class="text-3xl font-bold text-stone-900 dark:text-white mb-8">Flash Sale</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white dark:bg-stone-900 p-8 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm">
                            <h3 class="font-bold text-lg mb-6 dark:text-white flex items-center gap-2"><i data-lucide="zap" class="w-5 h-5 text-orange-500"></i> Buat Diskon Baru</h3>
                            <div class="space-y-6">
                                <div>
                                    <label class="text-xs font-bold text-stone-400 uppercase tracking-wider mb-2 block">1. Pilih Produk</label>
                                    <div class="relative">
                                        <select id="discProductSelect" class="input-field appearance-none cursor-pointer"></select>
                                        <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="text-xs font-bold text-stone-400 uppercase tracking-wider mb-2 block">2. Harga Promo (Rp)</label>
                                        <input type="number" id="discPrice" class="input-field" placeholder="Contoh: 150000">
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-stone-400 uppercase tracking-wider mb-2 block">3. Kuota (Pcs)</label>
                                        <input type="number" id="discStock" class="input-field" placeholder="Contoh: 10">
                                    </div>
                                </div>
                                <button onclick="window.applyDiscount()" class="btn-primary w-full mt-2">Terapkan Diskon</button>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-stone-900 p-8 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm h-fit">
                            <h3 class="font-bold text-lg mb-6 text-orange-600 flex items-center gap-2"><i data-lucide="activity" class="w-5 h-5"></i> Sedang Aktif</h3>
                            <ul id="activeDiscounts" class="space-y-4">
                                <li class="text-sm text-stone-400 italic text-center py-4">Belum ada promo aktif.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="tab-settings" class="hidden animate-fade-in">
                    <h1 class="text-3xl font-bold text-stone-900 dark:text-white mb-8">Pengaturan Toko</h1>
                    <div class="max-w-2xl bg-white dark:bg-stone-900 p-8 rounded-[2rem] border border-stone-100 dark:border-stone-800 shadow-sm">
                        <label class="text-xs font-bold text-stone-400 uppercase tracking-wider mb-3 block">URL Gambar QRIS</label>
                        <div class="flex flex-col md:flex-row gap-4">
                            <input type="text" id="settingQris" class="input-field" placeholder="https://...">
                            <button onclick="window.saveSettings()" class="btn-primary whitespace-nowrap">Simpan</button>
                        </div>
                        <div class="mt-8 p-4 bg-orange-50 dark:bg-orange-900/10 border border-orange-100 dark:border-orange-800/30 text-orange-800 dark:text-orange-200 text-xs rounded-2xl flex gap-3 items-start leading-relaxed">
                            <i data-lucide="shield-alert" class="w-5 h-5 shrink-0 mt-0.5"></i>
                            <div>
                                <p class="font-bold mb-1">Secure Admin Zone</p>
                                <p>Hanya akun yang terdaftar dalam whitelist database yang dapat menyimpan perubahan ini.</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <nav class="md:hidden fixed bottom-0 left-0 w-full glass-nav flex justify-around items-center px-4 py-3 pb-[env(safe-area-inset-bottom)] z-40 border-t border-stone-200 dark:border-stone-800">
            <button onclick="window.switchTab('insight')" id="mob-insight" class="mob-nav active"><i data-lucide="layout-dashboard" class="w-5 h-5"></i></button>
            <button onclick="window.switchTab('orders')" id="mob-orders" class="mob-nav relative"><i data-lucide="shopping-bag" class="w-5 h-5"></i></button>
            <button onclick="window.switchTab('products')" id="mob-products" class="mob-nav"><i data-lucide="package" class="w-5 h-5"></i></button>
            <button onclick="window.switchTab('discounts')" id="mob-discounts" class="mob-nav"><i data-lucide="ticket-percent" class="w-5 h-5"></i></button>
            <button onclick="window.switchTab('settings')" id="mob-settings" class="mob-nav"><i data-lucide="settings" class="w-5 h-5"></i></button>
        </nav>

    </div>

    <div id="productModal" class="hidden fixed inset-0 z-[60] bg-stone-900/60 backdrop-blur-sm flex items-end md:items-center justify-center p-0 md:p-4 transition-all">
        <div class="bg-white dark:bg-stone-900 w-full md:max-w-lg rounded-t-[2.5rem] md:rounded-[2.5rem] p-8 shadow-2xl animate-slide-up md:animate-fade-in max-h-[95vh] overflow-y-auto border dark:border-stone-800">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold text-stone-900 dark:text-white">Editor Produk</h2>
                <button onclick="window.closeProductModal()" class="p-3 bg-stone-50 dark:bg-stone-800 rounded-full hover:rotate-90 transition-transform"><i data-lucide="x" class="w-5 h-5 dark:text-white"></i></button>
            </div>
            <form id="productForm" class="space-y-5">
                <input type="hidden" id="editId">
                <input type="text" id="pName" placeholder="Nama Produk" required class="input-field font-bold text-lg">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="pPrice" placeholder="Harga (Rp)" required class="input-field">
                    <input type="number" id="pStock" placeholder="Stok" required class="input-field">
                </div>
                <div class="relative">
                     <select id="pCategory" class="input-field appearance-none cursor-pointer">
                        <option value="Small Items">Small Items</option>
                        <option value="Medium">Medium</option>
                        <option value="Statement">Statement</option>
                    </select>
                    <i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400 pointer-events-none"></i>
                </div>
                <input type="text" id="pImage" placeholder="URL Gambar Produk" required class="input-field">
                <textarea id="pDesc" placeholder="Deskripsi Singkat" rows="3" class="input-field"></textarea>
                <button type="submit" class="btn-primary w-full">Simpan Perubahan</button>
            </form>
        </div>
    </div>

    <div id="statusModal" class="hidden fixed inset-0 z-[60] bg-stone-900/60 backdrop-blur-sm flex items-end md:items-center justify-center p-0 md:p-4 transition-all">
        <div class="bg-white dark:bg-stone-900 w-full md:max-w-sm rounded-t-[2.5rem] md:rounded-[2.5rem] p-8 shadow-2xl animate-slide-up md:animate-fade-in border dark:border-stone-800">
            <h2 class="text-xl font-bold mb-6 text-center dark:text-white">Update Status</h2>
            <input type="hidden" id="statusOrderId">
            <div class="space-y-3">
                <button onclick="window.setStatus('Pesanan Sedang Ditinjau')" class="w-full text-left p-4 rounded-xl bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 font-bold text-sm hover:scale-[1.02] transition-transform border border-orange-100 dark:border-orange-800/30">1. Ditinjau</button>
                <button onclick="window.setStatus('Pesanan Sedang Dikemas')" class="w-full text-left p-4 rounded-xl bg-stone-50 dark:bg-stone-800 text-stone-700 dark:text-stone-300 font-bold text-sm hover:scale-[1.02] transition-transform">2. Dikemas</button>
                <button onclick="window.setStatus('Pesanan Sedang Diantarkan ke Jasa Logistik')" class="w-full text-left p-4 rounded-xl bg-stone-50 dark:bg-stone-800 text-stone-700 dark:text-stone-300 font-bold text-sm hover:scale-[1.02] transition-transform">3. OTW Logistik</button>
                <button onclick="window.setStatus('Pesanan Sedang Diantarkan oleh Jasa Logistik')" class="w-full text-left p-4 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-bold text-sm hover:scale-[1.02] transition-transform border border-blue-100 dark:border-blue-800/30">4. Dikirim Kurir</button>
                <button onclick="window.setStatus('Pesanan Diterima')" class="w-full text-left p-4 rounded-xl bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 font-bold text-sm hover:scale-[1.02] transition-transform border border-green-100 dark:border-green-800/30">5. Selesai (Diterima)</button>
                <div class="h-px bg-stone-100 dark:bg-stone-800 my-2"></div>
                <button onclick="window.setStatus('Pesanan Dibatalkan')" class="w-full text-left p-4 rounded-xl bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 font-bold text-sm hover:scale-[1.02] transition-transform border border-red-100 dark:border-red-800/30">X. Batalkan</button>
            </div>
            <button onclick="document.getElementById('statusModal').classList.add('hidden')" class="mt-6 w-full py-3 text-stone-400 hover:text-stone-900 dark:hover:text-white font-bold text-sm transition-colors">Tutup</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // Konfigurasi Project
        const firebaseConfig = {
            apiKey: "AIzaSyApD7dueaFuPv9hHGajcwo17LADEVriqRw",
            authDomain: "entry-6a64d.firebaseapp.com",
            databaseURL: "https://entry-6a64d-default-rtdb.firebaseio.com",
            projectId: "entry-6a64d",
            storageBucket: "entry-6a64d.firebasestorage.app",
            messagingSenderId: "939693440034",
            appId: "1:939693440034:web:ecd3d0366acf207add1e7b",
            measurementId: "G-RPTFXQK08B"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let salesChartInstance = null;
        let allOrdersData = [];

        // --- DARK MODE LOGIC ---
        window.toggleDarkMode = () => {
            const html = document.documentElement;
            if(html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            if(salesChartInstance) window.updateChart(document.querySelector('.chart-btn-active').id.replace('btn-chart-', ''));
        };

        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // --- AUTH LOGIC (Point 13 & 1) ---
        onAuthStateChanged(auth, async (user) => {
            const loginGate = document.getElementById('loginGate');
            const dashboardUI = document.getElementById('dashboardUI');
            const loginStatus = document.getElementById('loginStatus');

            if (user) {
                if(loginStatus) {
                    loginStatus.classList.remove('hidden');
                    loginStatus.textContent = "VERIFYING SECURE ACCESS...";
                }

                try {
                    const snapshot = await get(ref(db, 'admins/' + user.uid));
                    if (snapshot.exists() && snapshot.val() === true) {
                        // Admin Success
                        loginGate.classList.add('opacity-0', 'pointer-events-none');
                        setTimeout(() => loginGate.style.display = 'none', 500);
                        dashboardUI.classList.remove('hidden');
                        setTimeout(() => dashboardUI.classList.remove('opacity-0'), 100);
                        document.getElementById('adminEmailDisplay').textContent = user.email;
                        lucide.createIcons();
                        initAdmin(); 
                    } else {
                        // Point 13: Non-admin redirect to profile
                        window.location.href = 'profile.html'; 
                    }
                } catch (error) {
                    console.error(error);
                    alert("Koneksi database bermasalah.");
                }
            }
        });

        document.getElementById('btnLogin').addEventListener('click', () => signInWithPopup(auth, provider));
        
        // Point 1: Logout to index.html
        window.logout = () => signOut(auth).then(() => window.location.href = 'index.html');

        function initAdmin() {
            loadInsights();
            loadProducts();
            loadOrders();
            loadSettings();
        }

        // --- CHART & INSIGHT LOGIC (Points 5, 7, 8, 10) ---
        function loadInsights() {
            onValue(ref(db, 'users'), (snap) => document.getElementById('statUsers').textContent = snap.exists() ? Object.keys(snap.val()).length : 0);
            
            onValue(ref(db, 'orders'), (snap) => {
                let total = 0, monthTotal = 0, todayTotal = 0, weekTotal = 0, yearTotal = 0;
                const now = new Date();
                const todayStr = now.toDateString();
                const currentYear = now.getFullYear();

                // Get Monday of current week
                const d = new Date(now);
                const day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6 : 1); 
                const monday = new Date(d.setDate(diff)); monday.setHours(0,0,0,0);

                allOrdersData = [];

                if (snap.exists()) {
                    Object.values(snap.val()).forEach(o => {
                        const isValid = ['Pesanan Diterima', 'Selesai', 'Lunas'].some(s => o.status.includes(s));
                        if(isValid) {
                            const orderDate = new Date(o.timestamp);
                            allOrdersData.push({ date: orderDate, total: o.total });
                            
                            // Calculate Stats
                            total += o.total; // Lifetime
                            
                            if (orderDate.getFullYear() === currentYear) {
                                yearTotal += o.total; // Year
                                if (orderDate.getMonth() === now.getMonth()) monthTotal += o.total; // Month
                            }
                            
                            if (orderDate.toDateString() === todayStr) todayTotal += o.total; // Today
                            
                            if (orderDate >= monday) weekTotal += o.total; // Week
                        }
                    });
                }
                
                // Update DOM
                document.getElementById('statRevenue').textContent = 'Rp ' + total.toLocaleString('id-ID');
                document.getElementById('statMonth').textContent = 'Rp ' + monthTotal.toLocaleString('id-ID');
                document.getElementById('statToday').textContent = 'Rp ' + todayTotal.toLocaleString('id-ID'); // Point 7
                document.getElementById('statWeek').textContent = 'Rp ' + weekTotal.toLocaleString('id-ID'); // Point 7
                document.getElementById('statYear').textContent = 'Rp ' + yearTotal.toLocaleString('id-ID'); // Point 7

                // Default chart
                window.updateChart('day');
            });
        }

        // Point 4: Trigger Scroll, Glow & Update
        window.focusChart = (period) => {
            window.updateChart(period);
            const chartSec = document.getElementById('chartSection');
            
            // Scroll
            chartSec.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Glow Effect
            chartSec.classList.add('shadow-[0_0_40px_rgba(234,88,12,0.3)]', 'border-orange-500');
            setTimeout(() => {
                chartSec.classList.remove('shadow-[0_0_40px_rgba(234,88,12,0.3)]', 'border-orange-500');
            }, 1500);
        };

        window.updateChart = (period) => {
            // Update Buttons State
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('chart-btn-active');
                btn.classList.add('chart-btn-inactive');
            });
            document.getElementById(`btn-chart-${period}`).classList.remove('chart-btn-inactive');
            document.getElementById(`btn-chart-${period}`).classList.add('chart-btn-active');

            const ctx = document.getElementById('salesChart').getContext('2d');
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#a8a29e' : '#78716c';
            
            let labels = [], dataPoints = []; 
            const now = new Date();

            if (period === 'day') {
                labels = Array.from({length: 24}, (_, i) => `${i}:00`);
                dataPoints = new Array(24).fill(0);
                allOrdersData.forEach(o => { if(o.date.toDateString() === now.toDateString()) dataPoints[o.date.getHours()] += o.total; });
            } else if (period === 'week') {
                labels = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
                dataPoints = new Array(7).fill(0);
                const day = now.getDay() || 7; 
                const monday = new Date(now); 
                monday.setDate(now.getDate() - (day - 1)); monday.setHours(0,0,0,0);
                
                allOrdersData.forEach(o => {
                    const diffDays = Math.floor((o.date - monday) / (86400000));
                    if (diffDays >= 0 && diffDays < 7) dataPoints[diffDays] += o.total;
                });
            } else if (period === 'month') {
                const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
                labels = Array.from({length: daysInMonth}, (_, i) => `${i+1}`);
                dataPoints = new Array(daysInMonth).fill(0);
                allOrdersData.forEach(o => { if(o.date.getMonth() === now.getMonth()) dataPoints[o.date.getDate()-1] += o.total; });
            } else if (period === 'year') {
                labels = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                dataPoints = new Array(12).fill(0);
                allOrdersData.forEach(o => { if(o.date.getFullYear() === now.getFullYear()) dataPoints[o.date.getMonth()] += o.total; });
            } else if (period === 'total') {
                // Point 8: Logic for Total (Only show 2026 onwards if data exists)
                const years = [...new Set(allOrdersData.map(o => o.date.getFullYear()))].sort().filter(y => y >= 2026);
                if (years.length === 0) years.push(2026); // Min 2026
                labels = years.map(String);
                dataPoints = years.map(y => allOrdersData.filter(o => o.date.getFullYear() === y).reduce((a,b) => a + b.total, 0));
            }

            if (salesChartInstance) salesChartInstance.destroy();
            
            // Point 8: Solid/Thick Chart style when triggered
            salesChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pendapatan',
                        data: dataPoints,
                        backgroundColor: '#ea580c',
                        borderRadius: 6,
                        barThickness: period === 'month' ? 4 : (period === 'total' ? 40 : 12),
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            border: { display: false },
                            grid: { color: isDark ? '#292524' : '#f5f5f4' }, 
                            ticks: { 
                                color: textColor, 
                                font: { size: 10 },
                                precision: 0, // Point 10: No Decimals
                                callback: function(value) { return 'Rp ' + (value/1000) + 'k'; }
                            } 
                        },
                        x: { 
                            grid: { display: false }, 
                            ticks: { color: textColor, font: { size: 10 } }, 
                            border: { display: false } 
                        }
                    }
                }
            });
        };

        // --- ORDER LIST ---
        function loadOrders() {
            onValue(ref(db, 'orders'), (snapshot) => {
                const list = document.getElementById('orderList');
                list.innerHTML = '';
                const data = snapshot.val();
                
                if(data) {
                    const orders = Object.entries(data).sort((a,b) => b.val().timestamp - a.val().timestamp);
                    document.getElementById('orderCountBadge').textContent = `${orders.length} Order`;

                    orders.forEach(([id, o]) => {
                        if (o.status === 'Pesanan Diterima' && (Date.now() - o.lastStatusUpdate > 259200000)) update(ref(db, 'orders/'+id), { status: 'Selesai' });

                        let statusColor = 'bg-stone-100 text-stone-600 dark:bg-stone-800 dark:text-stone-400';
                        if(o.status.includes('Ditinjau')) statusColor = 'bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400';
                        if(o.status.includes('Diterima') || o.status === 'Selesai') statusColor = 'bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-400';
                        if(o.status.includes('Dibatalkan')) statusColor = 'bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-400';

                        list.innerHTML += `
                            <div class="stat-card group relative overflow-hidden">
                                <div class="flex justify-between items-start mb-4 relative z-10">
                                    <div>
                                        <div class="flex items-center gap-2 mb-1">
                                            <h4 class="font-bold text-stone-900 dark:text-white text-lg">${o.customerName}</h4>
                                            <a href="https://wa.me/${o.customerPhone}" target="_blank" class="p-1 rounded-full bg-green-50 dark:bg-green-900/20 text-green-600 hover:scale-110 transition-transform"><i data-lucide="message-circle" class="w-4 h-4"></i></a>
                                        </div>
                                        <div class="text-[10px] text-stone-400 font-mono">${new Date(o.timestamp).toLocaleDateString()} â€¢ ${id.slice(-4)}</div>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide ${statusColor}">${o.status}</span>
                                </div>
                                
                                <div class="bg-stone-50 dark:bg-stone-800/50 p-4 rounded-2xl flex gap-4 mb-5 border border-stone-100 dark:border-stone-800 relative z-10">
                                    <div class="w-12 h-12 bg-white dark:bg-stone-800 rounded-xl flex-shrink-0 flex items-center justify-center shadow-sm">
                                        <i data-lucide="package" class="w-6 h-6 text-stone-300 dark:text-stone-600"></i>
                                    </div>
                                    <div class="overflow-hidden">
                                        <div class="font-bold text-sm truncate text-stone-800 dark:text-stone-200">${o.productName}</div>
                                        <div class="flex justify-between items-center w-full mt-1 gap-4">
                                            <span class="text-xs text-stone-500">${o.qty} pcs</span>
                                            <span class="text-xs font-bold text-orange-600 dark:text-orange-400">Rp ${parseInt(o.total).toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="window.openStatusModal('${id}')" class="w-full py-3 bg-stone-900 dark:bg-white text-white dark:text-stone-900 rounded-xl text-xs font-bold hover:opacity-90 transition-opacity">Update Status</button>
                            </div>`;
                    });
                    lucide.createIcons();
                } else {
                    list.innerHTML = `<div class="col-span-full text-center py-24 bg-stone-50 dark:bg-stone-900 rounded-[2.5rem] border-2 border-dashed border-stone-200 dark:border-stone-800 text-stone-400">Belum ada pesanan masuk.</div>`;
                }
            });
        }

        window.openStatusModal = (id) => { document.getElementById('statusOrderId').value = id; document.getElementById('statusModal').classList.remove('hidden'); };
        window.setStatus = (status) => {
            const id = document.getElementById('statusOrderId').value;
            update(ref(db, 'orders/' + id), { status: status, lastStatusUpdate: Date.now() })
            .then(() => document.getElementById('statusModal').classList.add('hidden'))
            .catch((err) => alert("Gagal: Izin Ditolak."));
        };

        // --- PRODUCT LOGIC ---
        function loadProducts() {
            const tbody = document.getElementById('productTableBody');
            const select = document.getElementById('discProductSelect');
            const discList = document.getElementById('activeDiscounts');
            
            onValue(ref(db, 'products'), (snap) => {
                tbody.innerHTML = ''; select.innerHTML = '<option value="">Pilih Produk...</option>'; discList.innerHTML = '';
                const data = snap.val();
                if(data) {
                    Object.entries(data).forEach(([id, p]) => {
                        const hasPromo = p.discountStock > 0;
                        
                        tbody.innerHTML += `
                            <tr class="hover:bg-stone-50 dark:hover:bg-stone-800/50 transition-colors group">
                                <td class="p-6">
                                    <div class="flex items-center gap-4">
                                        <img src="${p.image}" class="w-12 h-12 rounded-xl object-cover bg-stone-100 shadow-sm" onerror="this.src='https://via.placeholder.com/150'">
                                        <div>
                                            <div class="font-bold text-stone-900 dark:text-white">${p.name}</div>
                                            <div class="text-[10px] text-stone-400 font-mono mt-0.5">${id.slice(-4)}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="p-6 hidden md:table-cell">
                                    <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-stone-100 dark:bg-stone-800 text-stone-600 dark:text-stone-300 uppercase tracking-wide border border-stone-200 dark:border-stone-700">${p.category}</span>
                                </td>
                                <td class="p-6">
                                    <div class="font-bold ${p.stock < 5 ? 'text-red-500' : 'text-stone-800 dark:text-stone-200'}">${p.stock} pcs</div>
                                    <div class="text-xs text-stone-400">Rp ${parseInt(p.price).toLocaleString()}</div>
                                    ${hasPromo ? '<span class="text-[10px] text-red-500 font-bold block mt-1 animate-pulse">ðŸ”¥ Promo Aktif</span>' : ''}
                                </td>
                                <td class="p-6 text-right">
                                    <div class="flex justify-end gap-2">
                                        <button onclick="window.editProduct('${id}')" class="p-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-100 transition-colors"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                                        <button onclick="window.deleteProduct('${id}')" class="p-2 bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400 rounded-lg hover:bg-red-100 transition-colors"><i data-lucide="trash" class="w-4 h-4"></i></button>
                                    </div>
                                </td>
                            </tr>`;
                        
                        select.innerHTML += `<option value="${id}">${p.name}</option>`;
                        if(hasPromo) {
                            discList.innerHTML += `
                                <li class="flex justify-between items-center bg-orange-50 dark:bg-orange-900/10 p-4 rounded-2xl border border-orange-100 dark:border-orange-800/30">
                                    <div>
                                        <div class="text-sm font-bold text-stone-900 dark:text-white">${p.name}</div>
                                        <div class="text-xs text-orange-600 dark:text-orange-400 font-bold mt-1">Rp ${parseInt(p.discountPrice).toLocaleString()}</div>
                                        <div class="text-[10px] text-stone-500 mt-1">Sisa Kuota: ${p.discountStock}</div>
                                    </div>
                                    <button onclick="window.stopDiscount('${id}')" class="text-xs font-bold text-red-500 bg-white dark:bg-stone-800 px-3 py-2 rounded-xl hover:bg-red-50 transition-colors shadow-sm">Stop</button>
                                </li>`;
                        }
                    });
                    if (discList.innerHTML === '') discList.innerHTML = '<li class="text-sm text-stone-400 italic text-center py-4">Belum ada promo aktif.</li>';
                    lucide.createIcons();
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-stone-400">Belum ada produk.</td></tr>';
                }
            });
        }

        // --- UTILS ---
        window.applyDiscount = () => {
            const id = document.getElementById('discProductSelect').value;
            const price = document.getElementById('discPrice').value;
            const stock = document.getElementById('discStock').value;
            if(!id || !price || !stock) return alert("Lengkapi data promo!");
            update(ref(db, 'products/' + id), { discountPrice: parseInt(price), discountStock: parseInt(stock) }).then(()=>alert("Promo Berhasil!")).catch(err => alert("Gagal: Izin Ditolak."));
        };
        window.stopDiscount = (id) => update(ref(db, 'products/' + id), { discountStock: 0 });
        window.saveSettings = () => set(ref(db, 'settings'), { qrisUrl: document.getElementById('settingQris').value }).then(()=>alert("Disimpan!")).catch(err => alert("Gagal: Izin Ditolak."));
        function loadSettings() { onValue(ref(db, 'settings'), (snap) => { if(snap.val()?.qrisUrl) document.getElementById('settingQris').value = snap.val().qrisUrl; }); }

        window.switchTab = (tab) => {
            ['insight', 'orders', 'products', 'discounts', 'settings'].forEach(t => {
                document.getElementById('tab-'+t).classList.add('hidden');
                document.getElementById('desk-'+t)?.classList.remove('active');
                document.getElementById('mob-'+t)?.classList.remove('active');
            });
            document.getElementById('tab-'+tab).classList.remove('hidden');
            document.getElementById('desk-'+tab)?.classList.add('active');
            document.getElementById('mob-'+tab)?.classList.add('active');
        };

        const form = document.getElementById('productForm');
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('editId').value || Date.now().toString();
            update(ref(db, 'products/' + id), {
                name: document.getElementById('pName').value, price: document.getElementById('pPrice').value, stock: document.getElementById('pStock').value,
                category: document.getElementById('pCategory').value, image: document.getElementById('pImage').value, desc: document.getElementById('pDesc').value
            }).then(() => window.closeProductModal()).catch(err => alert("Gagal: Izin Ditolak."));
        });

        window.deleteProduct = (id) => { if(confirm('Hapus produk ini?')) remove(ref(db, 'products/' + id)); };
        window.editProduct = (id) => {
            get(ref(db, 'products/' + id)).then((snapshot) => {
                const p = snapshot.val();
                document.getElementById('editId').value = id;
                document.getElementById('pName').value = p.name;
                document.getElementById('pPrice').value = p.price;
                document.getElementById('pStock').value = p.stock;
                document.getElementById('pCategory').value = p.category;
                document.getElementById('pImage').value = p.image;
                document.getElementById('pDesc').value = p.desc;
                window.openProductModal();
            });
        };
        window.openProductModal = () => { document.getElementById('productForm').reset(); document.getElementById('editId').value = ''; document.getElementById('productModal').classList.remove('hidden'); };
        window.closeProductModal = () => document.getElementById('productModal').classList.add('hidden');
    </script>
</body>
</html>
